genus_name <- subset(x, genus == y)$genus
species_name <- subset(x, genus == y)$species
var <- subset(x, genus == y)[,variable]
# Sample without replacement
random_mode <- sample(subset(x, genus == y)$mode)
# Return a partial data frame (for each genus)
return(data.frame(genus_name, species_name, var, random_mode))
}
####################################################
# For each genus, run the random_test() function.
zval_model <- function(data, n.genera, count=F){
# Complete data frame initialization.
ref.distri <- data.frame(x= character(0), y= character(0), z = character(0))
for (t in 1:n.genera) {
# Sub data frame (for each genus).
part_distri <- random_test(data, levels(data$genus)[t])
# Concatenation of each sub data frames.
ref.distri <- rbind(ref.distri, part_distri)
}
#print(ref.distri)
# Model
if(count){
m1 <- glmer(var ~ random_mode + (1|genus_name), data = ref.distri,family = "poisson")
st <- "z"
} else{
m1 <- lmer(var ~ random_mode + (1|genus_name), data = ref.distri)
st <- "t"
}
return(coef(summary(m1))[2, paste0(st," value")]) # Return zvalue
}
cl <- makeCluster(detectCores()-1)
clusterEvalQ(cl,c(library(nlme),library(lme4)))
clusterExport(cl,c("random_test","zval_model","data","n.genera","variable"))
par(mfrow=c(3,2))
for(v in c("nbr_country","max_dist_eq","min_dist_eq","lat_mean","lat_median","host_spp")){
variable = v
start_time <- proc.time()[3]
clusterExport(cl,"variable")
fmla <- as.formula(paste(variable,"~ mode + (1|genus)",sep=" "))
if(v %in% c("nbr_country","host_spp")){
zval.reference <-parSapply(cl, 1:nboot, function(i,...){zval_model(data,n.genera,count=T)})
m_host <- glmer(fmla, data = data,family = "poisson")
st <- "z"
}
else{
zval.reference <-parSapply(cl, 1:nboot, function(i,...){zval_model(data,n.genera)})
m_host <- lmer(fmla, data = data)
st <- "t"
}
z.obs <- coef(summary(m_host))[2, paste0(st, " value")]
hist(main=paste0(variable, "\n","P-value = ",sum(z.obs>zval.reference)/nboot),zval.reference,
breaks = 100, xlim=c(min(c(zval.reference,z.obs)), max(c(zval.reference,z.obs)))) # Vector of nboot pvalues.
abline(v=z.obs, col="red", lwd=3)
print(paste0("P-value for ", variable, " is: ", sum(z.obs>zval.reference)/nboot))
print(paste0(nboot, " simulations for ", variable, " took ", unname(proc.time()[3]-start_time), " seconds"))
}
stopCluster(cl)
data0 <- read.csv("~/Documents/Internship/Data/R_working_directory/auto/auto_processed_data.csv", header=T)
citat <-read.csv("~/Dropbox/Cyril-Casper_shared/Internship_tidy/Data/auto/auto_citations_per_species.csv", header=T)
data <- merge(x=data0, y=citat, by.x=c("family","genus","species"), by.y=c("family","genus","species"), all=F)
data <- data[!data$nbr_country =="0",] #remove species with no countries described
data <- data[!data$host_spp =="0",] # remove species with no hosts described
data0 <- read.csv("~/Documents/Internship/Data/R_working_directory/auto/auto_processed_data.csv", header=T)
citat <-read.csv("~/Dropbox/Cyril-Casper_shared/Internship_tidy/Data/auto/auto_citations_per_species.csv", header=T)
data <- merge(x=data0, y=citat, by.x=c("family","genus","species"), by.y=c("family","genus","species"), all=F)
data <- data[!data$nbr_country =="0",] #remove species with no countries described
data <- data[!data$host_spp =="0",] # remove species with no hosts described
cut_data <- data[data$ref>4,] # remove species very few studies
data<-cut_data
data$max_dist_eq <- pmax(abs(data$lat_min),abs(data$lat_max))
data$min_dist_eq <- pmin(abs(data$lat_min),abs(data$lat_max))
prcomp(x = data)
colnames(data)
prcomp(x = data[,4:15])
plot(prcomp(x = data[,4:15]))
colnames(data[16])
plot(prcomp(x = data[,4:16]))
pc <- prcomp(x = data[,4:15])
pc <- prcomp(x = data[,4:15])$x
pc
pc <- prcomp(x = data[,4:15])
str(pc)
pc <- prcomp(x = data[,4:15])$x
plot(pc[,1],pc[,2])
plot(pc[,1],pc[,2])
plot(pc[,1],pc[,2],col=data$mode)
ggplot(aes(x=pc[,1],y=pc[,2],col=data$mode))
library(ggplotw)
library(ggplot2)
ggplot(aes(x=pc[,1],y=pc[,2],col=data$mode))+
geom_points()
ggplot(aes(x=pc[,1],y=pc[,2],col=data$mode))+
geom_point()
ggplot(aes(x=pc[,1],y=pc[,2]))+
geom_point()
pc[,1]
options(scipen=999)
cut_data <- data[data$ref>4,] # remove species very few studies
data<-cut_data
data$max_dist_eq <- pmax(abs(data$lat_min),abs(data$lat_max))
data$min_dist_eq <- pmin(abs(data$lat_min),abs(data$lat_max))
pc <- prcomp(x = data[,4:15])$x
ggplot(aes(x=pc[,1],y=pc[,2],col=data$mode))+
geom_point()
pc
ggplot(aes(x=pc[,1],y=pc[,2],col=data$mode))+
geom_points()
geom_point()
ggplot(aes(x=pc[,1],y=pc[,2],col=data$mode))+
geom_point()
ggplot(data=pc,aes(x=pc[,1],y=pc[,2],col=data$mode))+
geom_point()
ggplot(data=pc,aes(x=1,y=,2,col=data$mode))+
geom_point()
ggplot(data=pc,aes(x=1,y=2,col=data$mode))+
geom_point()
ggplot(data=pc,aes(x=1,y=2))+
geom_point()
PC1 <- pc[,1]
PC2 <- pc[,2]
ggplot(aes(x=PC1,y=PC2))+
geom_point()
ggplot()+
geom_point(data=pc,aes(x=pc[,1],y=pc[,2],col=data$mode))
ggplot()+
geom_point(aes(x=pc[,1],y=pc[,2],col=data$mode))
ggplot()+
geom_point(aes(x=pc[,1],y=pc[,3],col=data$mode))
ggplot()+
geom_point(aes(x=pc[,2],y=pc[,3],col=data$mode))
dotplot(pc[,2],col=data$mode)
Dotplot(pc[,2],col=data$mode)
DotPlot(pc[,2],col=data$mode)
lattice::dotdlot(pc[,2],col=data$mode)
lattice:::dotdlot(pc[,2],col=data$mode)
lattice:::dotplot(pc[,2],col=data$mode)
ggplot()+
geom_point(aes(x=pc[,2],y=pc[,3],col=data$mode))
ggplot()+
geom_point(aes(x=pc[,2],y=pc[,4],col=data$mode))
weight <- prcomp(x=data[,4:15])$rotation
barplot(weight[,1])
barplot(weight[,2])
barplot(weight[,3])
ggplot()+
geom_point(aes(x=pc[,1],y=pc[,3],col=data$mode))
barplot(weight[,4])
barplot(weight[,5])
barplot(weight[,6])
barplot(weight[,7])
ggplot()+
geom_point(aes(x=pc[,5],y=pc[,7],col=data$mode))
library("factoextra")
install.packages("factoextra")
install.packages("factoextra")
install.packages("factoextra")
install.packages("factoextra")
install.packages("factoextra")
install.packages("factoextra")
install.packages("factoextra")
install.packages("factoextra")
install.packages("factoextra")
install.packages("factoextra")
install.packages("factoextra")
install.packages("FactoMineR")
library("FactoMineR")
res.pca <- PCA(data[,4:15], graph = FALSE)
fviz_screeplot(res.pca, ncp=10)
library("FactoMineR"); library(factoextra)
library(ggplot2)
rm(list=ls()); library(permute); library(nlme); library(lme4);library(parallel)
data0 <- read.csv("~/Documents/Internship/Data/R_working_directory/auto/auto_processed_data.csv", header=T)
#data0 <- read.csv("~/Documents/Internship/chalcid_comparative_analysis/Data/R_working_directory/auto/auto_processed_data.csv", header=T)
citat <-read.csv("~/Dropbox/Cyril-Casper_shared/Internship_tidy/Data/auto/auto_citations_per_species.csv", header=T)
data <- merge(x=data0, y=citat, by.x=c("family","genus","species"), by.y=c("family","genus","species"), all=F)
data <- data[!data$nbr_country =="0",] #remove species with no countries described
data <- data[!data$host_spp =="0",] # remove species with no hosts described
#data2 <- data[data$ref>2,]
#data<-data2
data$max_dist_eq <- pmax(abs(data$lat_min),abs(data$lat_max))
#data <- data[(data$lat_max*data$lat_min)>0,]
data$hemi <- rep(0,nrow(data))
data$hemi[data$lat_min > 0] <- "N"
data$hemi[data$lat_max < 0] <- "S"
mindist <- function(myrow){
Min = as.numeric(myrow[5])
Max = as.numeric(myrow[7])
if((Max*Min) > 0){
min_dist_eq <- pmin(abs(Min),abs(Max))
} else{
min_dist_eq <- 0
}
return(min_dist_eq)
}
data$lat_range <- abs(data$lat_max-data$lat_min)
data$lat_range[data$lat_range == 0] <- 0.001
tmp_mindist<- apply(data,MARGIN = 1,FUN = mindist)
data$min_dist_eq <- unname(tmp_mindist)
dif_sensi_shift <- data.frame(cutoff=seq(0,20))
namevec <- c(min_dist_eq="shift_min",max_dist_eq="shift_max",lat_range="shift_range")
for(cut in 0:20){
for(p in c("min_dist_eq","max_dist_eq","lat_range")){
dif_sensi_shift[(cut+1),namevec[p]] <- (mean(data[data$mode=="asex" & data$ref>cut,p])-mean(data[data$mode=="sex" & data$ref>cut,p]))*111
}
}
par(mfrow=c(1,2))
plot(rat_sensi_shift$cutoff,rat_sensi_shift$shift_min,type="l",col="blue",ylim=c(0,3),xlab="reference cutoff",ylab="ratio of mean asex/sex")
points(rat_sensi_shift$cutoff,rat_sensi_shift$shift_max,type = "l",col="red")
points(rat_sensi_shift$cutoff,rat_sensi_shift$shift_range,type = "l",col="green")
legend("bottomleft",legend=c("min distance from equator","max distance from equator","latitude range"),fill = c("blue","red","green"))
plot(dif_sensi_shift$cutoff,dif_sensi_shift$shift_min,type="l",col="blue",ylim=c(-5000,5000),ylab="km difference of mean asex-sex")
points(dif_sensi_shift$cutoff,dif_sensi_shift$shift_max,type = "l",col="red")
points(dif_sensi_shift$cutoff,dif_sensi_shift$shift_range,type = "l",col="green")
legend("bottomleft",legend=c("min distance from equator","max distance from equator","latitude range"),fill = c("blue","red","green"))
rat_sensi_shift <- data.frame(cutoff=seq(0,20))
namevec <- c(min_dist_eq="shift_min",max_dist_eq="shift_max",lat_range="shift_range")
for(cut in 0:20){
for(p in c("min_dist_eq","max_dist_eq","lat_range")){
rat_sensi_shift[(cut+1),namevec[p]] <- mean(data[data$mode=="asex" & data$ref>cut,p])/mean(data[data$mode=="sex" & data$ref>cut,p])
}
}
# Difference (in km)
dif_sensi_shift <- data.frame(cutoff=seq(0,20))
namevec <- c(min_dist_eq="shift_min",max_dist_eq="shift_max",lat_range="shift_range")
for(cut in 0:20){
for(p in c("min_dist_eq","max_dist_eq","lat_range")){
dif_sensi_shift[(cut+1),namevec[p]] <- (mean(data[data$mode=="asex" & data$ref>cut,p])-mean(data[data$mode=="sex" & data$ref>cut,p]))*111
}
}
par(mfrow=c(1,2))
plot(rat_sensi_shift$cutoff,rat_sensi_shift$shift_min,type="l",col="blue",ylim=c(0,3),xlab="reference cutoff",ylab="ratio of mean asex/sex")
points(rat_sensi_shift$cutoff,rat_sensi_shift$shift_max,type = "l",col="red")
points(rat_sensi_shift$cutoff,rat_sensi_shift$shift_range,type = "l",col="green")
legend("bottomleft",legend=c("min distance from equator","max distance from equator","latitude range"),fill = c("blue","red","green"))
plot(dif_sensi_shift$cutoff,dif_sensi_shift$shift_min,type="l",col="blue",ylim=c(-5000,5000),ylab="km difference of mean asex-sex")
points(dif_sensi_shift$cutoff,dif_sensi_shift$shift_max,type = "l",col="red")
points(dif_sensi_shift$cutoff,dif_sensi_shift$shift_range,type = "l",col="green")
legend("bottomleft",legend=c("min distance from equator","max distance from equator","latitude range"),fill = c("blue","red","green"))
par(mfrow=c(1,2))
plot(rat_sensi_shift$cutoff,rat_sensi_shift$shift_min,type="l",col="blue",ylim=c(-1,3),xlab="reference cutoff",ylab="ratio of mean asex/sex")
points(rat_sensi_shift$cutoff,rat_sensi_shift$shift_max,type = "l",col="red")
points(rat_sensi_shift$cutoff,rat_sensi_shift$shift_range,type = "l",col="green")
legend("bottomleft",legend=c("min distance from equator","max distance from equator","latitude range"),fill = c("blue","red","green"))
plot(dif_sensi_shift$cutoff,dif_sensi_shift$shift_min,type="l",col="blue",ylim=c(-5000,5000),ylab="km difference of mean asex-sex")
points(dif_sensi_shift$cutoff,dif_sensi_shift$shift_max,type = "l",col="red")
points(dif_sensi_shift$cutoff,dif_sensi_shift$shift_range,type = "l",col="green")
legend("bottomleft",legend=c("min distance from equator","max distance from equator","latitude range"),fill = c("blue","red","green"))
par(mfrow=c(1,2))
plot(rat_sensi_shift$cutoff,rat_sensi_shift$shift_min,type="l",col="blue",ylim=c(-1,3),xlab="reference cutoff",ylab="ratio of mean asex/sex")
points(rat_sensi_shift$cutoff,rat_sensi_shift$shift_max,type = "l",col="red")
points(rat_sensi_shift$cutoff,rat_sensi_shift$shift_range,type = "l",col="green")
abline(h=0,col="grey",lty=2)
legend("bottomleft",legend=c("min distance from equator","max distance from equator","latitude range"),fill = c("blue","red","green"))
plot(dif_sensi_shift$cutoff,dif_sensi_shift$shift_min,type="l",col="blue",ylim=c(-5000,5000),ylab="km difference of mean asex-sex")
points(dif_sensi_shift$cutoff,dif_sensi_shift$shift_max,type = "l",col="red")
points(dif_sensi_shift$cutoff,dif_sensi_shift$shift_range,type = "l",col="green")
abline(h=0,col="grey",lty=2)
legend("bottomleft",legend=c("min distance from equator","max distance from equator","latitude range"),fill = c("blue","red","green"))
par(mfrow=c(1,2))
plot(rat_sensi_shift$cutoff,rat_sensi_shift$shift_min,type="l",col="blue",ylim=c(-1,3),xlab="reference cutoff",ylab="ratio of mean asex/sex")
points(rat_sensi_shift$cutoff,rat_sensi_shift$shift_max,type = "l",col="red")
points(rat_sensi_shift$cutoff,rat_sensi_shift$shift_range,type = "l",col="green")
abline(h=0,col="darkgrey",lty=2)
legend("bottomleft",legend=c("min distance from equator","max distance from equator","latitude range"),fill = c("blue","red","green"))
plot(dif_sensi_shift$cutoff,dif_sensi_shift$shift_min,type="l",col="blue",ylim=c(-5000,5000),ylab="km difference of mean asex-sex")
points(dif_sensi_shift$cutoff,dif_sensi_shift$shift_max,type = "l",col="red")
points(dif_sensi_shift$cutoff,dif_sensi_shift$shift_range,type = "l",col="green")
abline(h=0,col="grey",lty=2)
legend("bottomleft",legend=c("min distance from equator","max distance from equator","latitude range"),fill = c("blue","red","green"))
par(mfrow=c(1,2))
plot(rat_sensi_shift$cutoff,rat_sensi_shift$shift_min,type="l",col="blue",ylim=c(-1,3),xlab="reference cutoff",ylab="ratio of mean asex/sex")
points(rat_sensi_shift$cutoff,rat_sensi_shift$shift_max,type = "l",col="red")
points(rat_sensi_shift$cutoff,rat_sensi_shift$shift_range,type = "l",col="green")
abline(h=0,col="darkgrey",lty=2)
legend("bottomleft",legend=c("min distance from equator","max distance from equator","latitude range"),fill = c("blue","red","green"))
plot(dif_sensi_shift$cutoff,dif_sensi_shift$shift_min,type="l",col="blue",ylim=c(-5000,5000),ylab="km difference of mean asex-sex")
points(dif_sensi_shift$cutoff,dif_sensi_shift$shift_max,type = "l",col="red")
points(dif_sensi_shift$cutoff,dif_sensi_shift$shift_range,type = "l",col="green")
abline(h=0,col="grey",lty=2)
legend("bottomleft",legend=c("min distance from equator","max distance from equator","latitude range"),fill = c("blue","red","green"))
par(mfrow=c(1,2))
plot(rat_sensi_shift$cutoff,rat_sensi_shift$shift_min,type="l",col="blue",ylim=c(-1,3),xlab="reference cutoff",ylab="ratio of mean asex/sex")
points(rat_sensi_shift$cutoff,rat_sensi_shift$shift_max,type = "l",col="red")
points(rat_sensi_shift$cutoff,rat_sensi_shift$shift_range,type = "l",col="green")
abline(h=0,col="black",lty=2)
legend("bottomleft",legend=c("min distance from equator","max distance from equator","latitude range"),fill = c("blue","red","green"))
plot(dif_sensi_shift$cutoff,dif_sensi_shift$shift_min,type="l",col="blue",ylim=c(-5000,5000),ylab="km difference of mean asex-sex")
points(dif_sensi_shift$cutoff,dif_sensi_shift$shift_max,type = "l",col="red")
points(dif_sensi_shift$cutoff,dif_sensi_shift$shift_range,type = "l",col="green")
abline(h=0,col="black",lty=2)
legend("bottomleft",legend=c("min distance from equator","max distance from equator","latitude range"),fill = c("blue","red","green"))
par(mfrow=c(1,2))
plot(rat_sensi_shift$cutoff,rat_sensi_shift$shift_min,type="l",col="blue",ylim=c(-1,3),xlab="reference cutoff",ylab="ratio of mean asex/sex")
points(rat_sensi_shift$cutoff,rat_sensi_shift$shift_max,type = "l",col="red")
points(rat_sensi_shift$cutoff,rat_sensi_shift$shift_range,type = "l",col="green")
abline(h=1,col="black",lty=2)
legend("bottomleft",legend=c("min distance from equator","max distance from equator","latitude range"),fill = c("blue","red","green"))
plot(dif_sensi_shift$cutoff,dif_sensi_shift$shift_min,type="l",col="blue",ylim=c(-5000,5000),ylab="km difference of mean asex-sex")
points(dif_sensi_shift$cutoff,dif_sensi_shift$shift_max,type = "l",col="red")
points(dif_sensi_shift$cutoff,dif_sensi_shift$shift_range,type = "l",col="green")
abline(h=0,col="black",lty=2)
legend("bottomleft",legend=c("min distance from equator","max distance from equator","latitude range"),fill = c("blue","red","green"))
23.43708*111
par(mfrow=c(1,2))
plot(rat_sensi_shift$cutoff,rat_sensi_shift$shift_min,type="l",col="blue",ylim=c(-1,3),
main="Ratios comparisons",xlab="reference cutoff",ylab="ratio of mean asex/sex")
points(rat_sensi_shift$cutoff,rat_sensi_shift$shift_max,type = "l",col="red")
points(rat_sensi_shift$cutoff,rat_sensi_shift$shift_range,type = "l",col="green")
abline(h=1,col="black",lty=2)
legend("bottomleft",legend=c("min distance from equator","max distance from equator","latitude range"),fill = c("blue","red","green"))
plot(dif_sensi_shift$cutoff,dif_sensi_shift$shift_min,type="l",col="blue",ylim=c(-5000,5000),
main="Differences comparisons",xlab="reference cutoff",ylab="km difference of mean asex-sex")
points(dif_sensi_shift$cutoff,dif_sensi_shift$shift_max,type = "l",col="red")
points(dif_sensi_shift$cutoff,dif_sensi_shift$shift_range,type = "l",col="green")
abline(h=0,col="black",lty=2)
legend("bottomleft",legend=c("min distance from equator","max distance from equator","latitude range"),fill = c("blue","red","green"))
rm(list=ls()); library(permute); library(nlme); library(lme4);library(parallel)
data0 <- read.csv("~/Documents/Internship/Data/R_working_directory/auto/auto_processed_data.csv", header=T)
#data0 <- read.csv("~/Documents/Internship/chalcid_comparative_analysis/Data/R_working_directory/auto/auto_processed_data.csv", header=T)
citat <-read.csv("~/Dropbox/Cyril-Casper_shared/Internship_tidy/Data/auto/auto_citations_per_species.csv", header=T)
data <- merge(x=data0, y=citat, by.x=c("family","genus","species"), by.y=c("family","genus","species"), all=F)
data <- data[!data$nbr_country =="0",] #remove species with no countries described
data <- data[!data$host_spp =="0",] # remove species with no hosts described
#data2 <- data[data$ref>2,]
#data<-data2
data$max_dist_eq <- pmax(abs(data$lat_min),abs(data$lat_max))
data <- data[(data$lat_max*data$lat_min)>0,]
data$hemi <- rep(0,nrow(data))
data$hemi[data$lat_min > 0] <- "N"
data$hemi[data$lat_max < 0] <- "S"
mindist <- function(myrow){
Min = as.numeric(myrow[5])
Max = as.numeric(myrow[7])
if((Max*Min) > 0){
min_dist_eq <- pmin(abs(Min),abs(Max))
} else{
min_dist_eq <- 0
}
return(min_dist_eq)
}
data$lat_range <- abs(data$lat_max-data$lat_min)
data$lat_range[data$lat_range == 0] <- 0.001
tmp_mindist<- apply(data,MARGIN = 1,FUN = mindist)
data$min_dist_eq <- unname(tmp_mindist)
# ==========================
# Only 2 asexual species are exclusively sampled in the southern hemisphere.
# Not relevant to analyze species separately for both hemispheres (2 species won't give enough info)
# Moreover, the have only been sampled once and twice, respectively.
#data[data$hemi=="S" & data$mode =="asex",]
#===============================
# Computing shift for max, min distance to equator and latitude range
# RESULTS WITH cutoff=2
#!!!!CAREFUL!!!! RESULTS DESCRIBED IN COMMENTS OBTAINED AFTER USING data[(data$lat_max*data$lat_min)>0,]
# MEANING ALL SPECIES OCCURING ACROSS THE EQUATOR HAVE BEEN REMOVED. UNCOMMENT LINES 9-12 TO REPRODUCE THESE RESULTS
# Ratios method
shift_max <- mean(data$max_dist_eq[data$mode=="asex"])/mean(data$max_dist_eq[data$mode=="sex"])
shift_min <- mean(data$min_dist_eq[data$mode=="asex"])/mean(data$min_dist_eq[data$mode=="sex"])
shift_range <- mean(data$lat_range[data$mode=="asex"])/mean(data$lat_range[data$mode=="sex"])
# Difference method
shift_max <- mean(data$max_dist_eq[data$mode=="asex"])- mean(data$max_dist_eq[data$mode=="sex"])
shift_min <- mean(data$min_dist_eq[data$mode=="asex"]) - mean(data$min_dist_eq[data$mode=="sex"])
shift_range <- mean(data$lat_range[data$mode=="asex"]) - mean(data$lat_range[data$mode=="sex"])
# max_dist_eq shift is positive (+18.6% [ratio] or +8.26째 [difference]) -> asexual distribution shifted towards poles
# min_dist_eq shift is slightly negative (-6.7% [ratio] or -2.05째 [difference]) -> asexual distribution slightly expands towards equator
# lat_range shift is highly positive (+73% [ratio] or 10.32째 [difference]) -> asexual have a larger latitude range.
# Since 1째 of latitude equals 111km -> Maxima of asexual distribution is shifted by 917.27km towards poles and minima by 227.833km towards equator,
# on average over all species in the auto dataset. Latitude range increases by 1145.077km for asexual on average.
#===============================
# TESTING SENSITIVITY OF RESULTS AT DIFFERENT CUTOFFS
# Ratio
rat_sensi_shift <- data.frame(cutoff=seq(0,20))
namevec <- c(min_dist_eq="shift_min",max_dist_eq="shift_max",lat_range="shift_range")
for(cut in 0:20){
for(p in c("min_dist_eq","max_dist_eq","lat_range")){
rat_sensi_shift[(cut+1),namevec[p]] <- mean(data[data$mode=="asex" & data$ref>cut,p])/mean(data[data$mode=="sex" & data$ref>cut,p])
}
}
# Difference (in km)
dif_sensi_shift <- data.frame(cutoff=seq(0,20))
namevec <- c(min_dist_eq="shift_min",max_dist_eq="shift_max",lat_range="shift_range")
for(cut in 0:20){
for(p in c("min_dist_eq","max_dist_eq","lat_range")){
dif_sensi_shift[(cut+1),namevec[p]] <- (mean(data[data$mode=="asex" & data$ref>cut,p])-mean(data[data$mode=="sex" & data$ref>cut,p]))*111
}
}
par(mfrow=c(1,2))
plot(rat_sensi_shift$cutoff,rat_sensi_shift$shift_min,type="l",col="blue",ylim=c(-1,3),
main="Ratios comparisons",xlab="reference cutoff",ylab="ratio of mean asex/sex")
points(rat_sensi_shift$cutoff,rat_sensi_shift$shift_max,type = "l",col="red")
points(rat_sensi_shift$cutoff,rat_sensi_shift$shift_range,type = "l",col="green")
abline(h=1,col="black",lty=2)
legend("bottomleft",legend=c("min distance from equator","max distance from equator","latitude range"),fill = c("blue","red","green"))
plot(dif_sensi_shift$cutoff,dif_sensi_shift$shift_min,type="l",col="blue",ylim=c(-5000,5000),
main="Differences comparisons",xlab="reference cutoff",ylab="km difference of mean asex-sex")
points(dif_sensi_shift$cutoff,dif_sensi_shift$shift_max,type = "l",col="red")
points(dif_sensi_shift$cutoff,dif_sensi_shift$shift_range,type = "l",col="green")
abline(h=0,col="black",lty=2)
legend("bottomleft",legend=c("min distance from equator","max distance from equator","latitude range"),fill = c("blue","red","green"))
library(ggplot2)
setwd("Dropbox/Cyril-Casper_shared/post_internship/final_perm_scripts/")
auto_data <- read.csv("auto_data.csv",header=T)
manual_data <- read.csv("manual_data.csv",header=T)
out_auto <- read.csv("output/out_auto.csv",header=T)
out_manual <- read.csv("output/out_manual.csv",header=T)
# Auto: number of species vs references cutoff
auto_size <- data.frame(cutoff=seq(0,20),size=rep(0,21))
for(c in seq(0,20)){auto_size$size[c+1] <- nrow(auto_data[auto_data$ref>c,])}
barplot(auto_size$size,names=auto_size$cutoff,xlab="More than n references",ylab="Number of species")
abline(h=118,lty=2,col="red")  # Number of species in manual dataset
# Model results vs reference cutoff
ggplot(data=out_auto,aes(x=ref,y=))+
facet_grid(~var)
ggplot(data=out_auto,aes(x=ref,y=pval2T,col=var))+
#facet_grid(~var)+
geom_line()+
geom_line(aes(y=0.05),col="red",lty=2)
ggplot(data=out_auto,aes(x=ref,y=pval1T,col=var))+
#facet_grid(~var)+
geom_line()+
geom_line(aes(y=0.05),col="red",lty=2)+xlab("Reference cutoff")+ylab("p-value")
ggplot(data=out_auto,aes(x=ref,y=pval2T,col=var))+
#facet_grid(~var)+
geom_line()+
geom_line(aes(y=0.05),col="red",lty=2)+xlab("Reference cutoff")+ylab("p-value")
ggplot(data=out_auto,aes(x=ref,y=z,col=var))+
#facet_grid(~var)+
geom_line()+
geom_line(aes(y=0.05),col="red",lty=2)+xlab("Reference cutoff")+ylab("p-value")
ggplot(data=out_auto,aes(x=ref,y=z,col=var))+
#facet_grid(~var)+
geom_line()+
geom_line(aes(y=0.05),col="red",lty=2)+xlab("Reference cutoff")+ylab("z-value")
View(auto_size)
View(out_auto)
out_auto <- out_auto[2:nrow(out_auto),]
out_auto <- read.csv("output/out_auto.csv",header=T)
out_auto <- out_auto[out_auto$ref>=0,]
ggplot(data=out_auto,aes(x=ref,y=pval2T,col=var))+
#facet_grid(~var)+
geom_line()+
geom_line(aes(y=0.05),col="red",lty=2)+xlab("Reference cutoff")+ylab("p-value")
ggplot(data=out_auto,aes(x=ref,y=z,col=var))+
#facet_grid(~var)+
geom_line()+
geom_line(aes(y=0),col="red",lty=2)+xlab("Reference cutoff")+ylab("z-value")
ggplot(data=out_auto,aes(x=ref,y=z,col=var))+
#facet_grid(~var)+
geom_line()+
geom_line(aes(y=0),col="red",lty=2)+xlab("Reference cutoff")+ylab("z-value")+theme_bw()
ggplot(data=out_auto,aes(x=ref,y=pval2T,col=var))+
#facet_grid(~var)+
geom_line()+
geom_line(aes(y=0.05),col="red",lty=2)+xlab("Reference cutoff")+ylab("p-value")+theme_minimal()
for(l in levels(out_auto$var)){print(l)}
for(l in levels(out_auto$var)){print(min(out_auto$ref[out_auto$var==l & out_auto$pval2T>=0.05]))}
for(l in levels(out_auto$var)){print(max(out_auto$ref[out_auto$var==l & out_auto$pval2T<0.05]))}
for(l in levels(out_auto$var)){print(paste(l,max(out_auto$ref[out_auto$var==l & out_auto$pval2T<0.05]),sep=": "))}
for(l in levels(out_auto$var)){
max_ref <- max(out_auto$ref[out_auto$var==l & out_auto$pval2T<0.05])
sample <- auto_size$size[auto_size$cutoff==max_ref]
print(paste(l,": ", max_ref, " (",sample, " species)"))}
for(l in levels(out_auto$var)){
max_ref <- max(out_auto$ref[out_auto$var==l & out_auto$pval2T<0.05])
sample <- auto_size$size[auto_size$cutoff==max_ref]
print(paste(l,": ", max_ref, " (",sample, " species left)"))}
auto_size <- data.frame(cutoff=seq(0,20),size=rep(0,21),n_asex=rep(0,21))
auto_size <- data.frame(cutoff=seq(0,20),size=rep(0,21),n_asex=rep(0,21))
for(c in seq(0,20)){auto_size$size[c+1] <- nrow(auto_data[auto_data$ref>c,])
auto_size$n_asex[c+1] <- nrow(auto_data[auto_data$ref>c & auto_data$mode=="asex",])
}
for(l in levels(out_auto$var)){
max_ref <- max(out_auto$ref[out_auto$var==l & out_auto$pval2T<0.05])
sample <- auto_size$size[auto_size$cutoff==max_ref]
asex <- auto_size$n_asex[auto_size$cutoff==max_ref]
print(paste(l,": ", max_ref, " (",sample, " species left, ",asex," asex)"))
}
ggplot(data=out_auto,aes(x=ref,y=z,col=var))+
#facet_grid(~var)+
geom_line()+
geom_line(aes(y=0),col="red",lty=2)+xlab("Reference cutoff")+ylab("z-value")+theme_bw()
ggplot(data=out_auto,aes(x=ref,y=z,col=var))+
#facet_grid(~var)+
geom_line()+
geom_line(data=out_manual,aes(y=z,col=var),lty=2)+
geom_line(aes(y=0),col="red",lty=2)+xlab("Reference cutoff")+ylab("z-value")+theme_bw()
ggplot(data=out_auto,aes(x=ref,y=z,col=var))+
#facet_grid(~var)+
geom_line()+
geom_line(data=out_manual,aes(y=z,col=var),lty=2)+
geom_line(aes(y=0),col="red",lty=2)+xlab("Reference cutoff")+ylab("z-value")+theme_bw()
geom_line(data=out_manual,aes(x=zy=z,col=var),lty=2)+
geom_line(aes(y=0),col="red",lty=2)+xlab("Reference cutoff")+ylab("z-value")+theme_bw()
ggplot(data=out_auto,aes(x=ref,y=z,col=var))+
#facet_grid(~var)+
geom_line()+
geom_line(data=out_manual,aes(x=zy=z,col=var),lty=2)+
geom_line(aes(y=0),col="red",lty=2)+xlab("Reference cutoff")+ylab("z-value")+theme_bw()
ggplot(data=out_auto,aes(x=ref,y=z,col=var))+
#facet_grid(~var)+
geom_line()+
geom_line(data=out_manual,aes(x=z,y=z,col=var),lty=2)+
geom_line(aes(y=0),col="red",lty=2)+xlab("Reference cutoff")+ylab("z-value")+theme_bw()
ggplot(data=out_auto,aes(x=ref,y=z,col=var))+
#facet_grid(~var)+
geom_line()+
geom_hline(data=out_manual,aes(y=z,col=var),lty=2)+
geom_line(aes(y=0),col="red",lty=2)+xlab("Reference cutoff")+ylab("z-value")+theme_bw()
ggplot(data=out_auto,aes(x=ref,y=z,col=var))+
#facet_grid(~var)+
geom_line()+
geom_hline(data=out_manual,aes(yintercept=z,col=var),lty=2)+
geom_line(aes(y=0),col="red",lty=2)+xlab("Reference cutoff")+ylab("z-value")+theme_bw()
