rm(list=ls()); library(permute); library(nlme); library(lme4)
data0 <- read.csv("~/Documents/Internship/Data/R_working_directory/auto/auto_processed_data.csv", header=T)
citat <-read.csv("~/Dropbox/Cyril-Casper_shared/Internship/Data/auto/auto_citations_per_species.csv", header=T)
data <- merge(x=data0, y=citat, by.x=c("family","genus","species"), by.y=c("family","genus","species"), all=F)
data <- data[!data$nbr_country =="0",] #remove species with no countries described
data <- data[!data$host_spp =="0",] # remove species with no hosts described
data2 <- data[data$ref>"2",] # remove species very few studies
data3 <- data[data$ref>"4",] # remove species very few studies
data4 <- data[data$ref>"7",] # remove species very few studies
par(mfrow=c(1,3))
boxplot(data$ref[data$mode=="sex"], data$ref[data$mode=="asex"], ylim=c(0,10))
boxplot(data2$ref[data2$mode=="sex"], data2$ref[data2$mode=="asex"], ylim=c(0,10))
boxplot(data3$ref[data3$mode=="sex"], data3$ref[data3$mode=="asex"], ylim=c(0,10))
boxplot(data4$ref[data4$mode=="sex"], data4$ref[data4$mode=="asex"], ylim=c(0,10))
manu0 <- read.csv("~/Documents/Internship/Data/R_working_directory/manual/manual_processed_data.csv")
View(manu0)
citat <-read.csv("~/Dropbox/Cyril-Casper_shared/Internship/Data/auto/auto_citations_per_species.csv", header=T)
manu <- merge(x=manu0, y=citat, by.x=c("family","genus","species"), by.y=c("family","genus","species"), all=F)
View(manu)
close_sex <-manu["pair"!=0,]
citat <-read.csv("~/Dropbox/Cyril-Casper_shared/Internship/Data/auto/auto_citations_per_species.csv", header=T)
manu0 <- read.csv("~/Documents/Internship/Data/R_working_directory/manual/manual_processed_data.csv")
manu <- merge(x=manu0, y=citat, by.x=c("family","genus","species"), by.y=c("family","genus","species"), all=F)
c("a","b","c")-c("a")
length(manu[pair=="asex"])
length(manu["pair"=="asex","species"])
length(manu$pair=="asex")
length(manu$pair=="sex")
length(manu[manu$pair=="sex","species"])
length(manu[manu$mode=="sex","species"])
length(manu[manu$mode=="asex","species"])
length(manu[manu0$mode=="asex","species"])
length(manu[manu0$mode=="sex","species"])
close_sex <-manu$pair!=0 & manu$mode=="sex",]
close_sex <-manu[manu$pair!=0 & manu$mode=="sex",]
close_sex0 <-manu[manu$pair!=0 & manu$mode=="sex",]
citat <-read.csv("~/Dropbox/Cyril-Casper_shared/Internship/Data/auto/auto_citations_per_species.csv", header=T)
manu0 <- read.csv("~/Documents/Internship/Data/R_working_directory/manual/manual_processed_data.csv")
manu <- merge(x=manu0, y=citat, by.x=c("family","genus","species"), by.y=c("family","genus","species"), all=F)
close_sex0 <-manu[manu$pair!=0 & manu$mode=="sex",]
close_sex <- cbind(close_sex0, diverg=rep("close"))
View(close_sex)
auto0 <- read.csv("~/Documents/Internship/Data/R_working_directory/auto/auto_processed_data.csv", header=T)
auto <- merge(x=auto0, y=citat, by.x=c("family","genus","species"), by.y=c("family","genus","species"), all=F)
close_sex <- close_sex[!close_sex$nbr_country=="0" & !close_sex$nbr_host_spp=="0",]
auto0 <- read.csv("~/Documents/Internship/Data/R_working_directory/auto/auto_processed_data.csv", header=T)
auto <- merge(x=auto0, y=citat, by.x=c("family","genus","species"), by.y=c("family","genus","species"), all=F)
auto <- auto[!auto$nbr_country =="0",] #remove species with no countries described
auto <- auto[!auto$host_spp =="0",] # remove species with no hosts described
far_sex0 <- auto[auto$mode=="sex"]
far_sex0 <- auto[auto$mode=="sex",]
far_sex <- cbind(far_sex0, diverg=rep("far"))
merged_sets <- merge(x=close_sex, y=far_sex, by.x=c("family", "genus"), by.y=c("family", "genus"))
View(merged_sets)
merged_sets <- rbind(close_sex, far_sex[far_sex$genus %in% close_sex$genus])
colnames(far_sex)
colnames(close_sex)
close_sex <- close_sex[,colnames(far_sex)])
close_sex <- close_sex[,colnames(far_sex)]
close_sex <- close_sex[,as.character(colnames(far_sex))]
close_sex <- close_sex[,colnames(far_sex)]
colnames(far_sex)
close_sex <- close_sex[,c("family", "genus", "species", "mode", "lon_min", "lon_max",
"lon_mean", "lon_median", "lat_min", "lat_max", "lat_mean",
"lat_median", "nbr_country", "nbr_host_spp", "eco", "ref", "diverg")]
colnames(close_sex)
colnames(far_sex)
length(colnames(far_sex))
length(colnames(close$_sex))
length(colnames(close_sex))
far_sex <- far_sex[, c("family", "genus", "species", "mode", "lon_min", "lon_max", "lon_mean",
"lon_median", "lat_min", "lat_max", "lat_mean", "lat_median", "nbr_country",
"host_spp", "eco", "ref", "diverg")]
length(colnames(close$_sex))
length(colnames(close_sex))
length(colnames(far_sex))
colnames(far_sex)
colnames(close_sex)
colnames(close_sex)[14]
colnames(close_sex)[14] <- "host_spp"
far_sex <- far_sex[, c("family", "genus", "species", "mode", "lon_min", "lon_max", "lon_mean",
)
]
colnames(close_sex)==colnames(far_sex)
merged_sets <- rbind(close_sex, far_sex[far_sex$genus %in% close_sex$genus,])
View(merged_sets)
merged_sets$genus
droplevels(levels(merged_sets$genus))
droplevel(levels(merged_sets$genus))
droplevels(levels(as.factor(merged_sets$genus)))
unique(merged_sets$genus)
merged_sets[genus=="NA"]
merged_sets[genus==NA]
merged_sets <- merged_sets[merged_sets$genus!=NA]
merged_sets <- merged_sets[merged_sets$genus!=NA,]
unique(merged_sets$genus)
View(merged_sets)
merged_sets <- rbind(close_sex, far_sex[far_sex$genus %in% close_sex$genus,])
merged_sets <- merged_sets[!is.na(merged_sets$genus),]
View(merged_sets)
unique(merged_sets$genus)
merged2 <- merged[merged_sets$ref>"2",] # remove species very few studies
merged2 <- merged_sets[merged_sets$ref>"2",] # remove species very few studies
merged3 <- merged_sets[merged_sets$ref>"4",] # remove species very few studies
merged4 <- merged_sets[merged_sets$ref>"7",] # remove species very few studies
View(merged4)
View(merged_sets)
duplicated(merged_sets$species)
test <- merged_sets[duplicated(merged_sets$genus)]
duplicated(merged_sets$genus)
test <- subset(merged_sets, subset = !all(duplicated(merged_sets$species),duplicated(merged_sets$species), merged_sets$diverg=="far"))
View(test)
test <- subset(merged_sets, subset = !(duplicated(merged_sets$species),duplicated(merged_sets$species), merged_sets$diverg=="far"))
test <- subset(merged_sets, subset = !(duplicated(merged_sets$species) & duplicated(merged_sets$species) &  merged_sets$diverg=="far"))
View(test)
duplicated(test$species)
length(duplicated(test$species))
length(duplicated(test$species)==T)
length(duplicated(test$species)==TRUE)
length(duplicated(test$species)==FALSE)
length(duplicated(test$species)=="FALSE")
length(duplicated(test$species)=="TRUE")
duplicated(test$species)=="TRUE"
duplicated(test$species)=="FALSE
"
rm(list=ls()); library(permute); library(nlme); library(lme4)
citat <-read.csv("~/Dropbox/Cyril-Casper_shared/Internship/Data/auto/auto_citations_per_species.csv", header=T)
manu0 <- read.csv("~/Documents/Internship/Data/R_working_directory/manual/manual_processed_data.csv")
manu <- merge(x=manu0, y=citat, by.x=c("family","genus","species"), by.y=c("family","genus","species"), all=F)
close_sex0 <-manu[manu$pair!=0 & manu$mode=="sex",]
close_sex <- cbind(close_sex0, diverg=rep("close"))
close_sex <- close_sex[!close_sex$nbr_country=="0" & !close_sex$nbr_host_spp=="0",]
auto0 <- read.csv("~/Documents/Internship/Data/R_working_directory/auto/auto_processed_data.csv", header=T)
auto <- merge(x=auto0, y=citat, by.x=c("family","genus","species"), by.y=c("family","genus","species"), all=F)
auto <- auto[!auto$nbr_country =="0",] #remove species with no countries described
auto <- auto[!auto$host_spp =="0",] # remove species with no hosts described
far_sex0 <- auto[auto$mode=="sex",]
far_sex <- cbind(far_sex0, diverg=rep("far"))
close_sex <- close_sex[,c("family", "genus", "species", "mode", "lon_min", "lon_max",
"lon_mean", "lon_median", "lat_min", "lat_max", "lat_mean",
"lat_median", "nbr_country", "nbr_host_spp", "eco", "ref", "diverg")]
colnames(close_sex)[14] <- "host_spp"
far_sex <- far_sex[, c("family", "genus", "species", "mode", "lon_min", "lon_max", "lon_mean",
"lon_median", "lat_min", "lat_max", "lat_mean", "lat_median", "nbr_country",
"host_spp", "eco", "ref", "diverg")]
merged_sets <- rbind(close_sex, far_sex[far_sex$genus %in% close_sex$genus,])
merged_sets <- merged_sets[!is.na(merged_sets$genus),]
merged <- subset(merged_sets, subset = !(duplicated(merged_sets$species) & duplicated(merged_sets$species) &  merged_sets$diverg=="far"))
merged2 <- merged[merged$ref>"2",] # remove species very few studies
merged3 <- merged[merged$ref>"4",] # remove species very few studies
merged4 <- merged[merged$ref>"7",] # remove species very few studies
par(mfrow=c(1,3))
boxplot(merged$ref[merged$mode=="sex"], merged$ref[merged$mode=="asex"], ylim=c(0,10))
boxplot(merged2$ref[merged2$mode=="sex"], merged2$ref[merged2$mode=="asex"], ylim=c(0,10))
boxplot(merged3$ref[merged3$mode=="sex"], merged3$ref[merged3$mode=="asex"], ylim=c(0,10))
par(mfrow=c(1,3))
boxplot(merged$ref[merged$diverg=="close"], merged$ref[merged$diverg=="far"], ylim=c(0,10))
boxplot(merged2$ref[merged2$diverg=="close"], merged2$ref[merged2$diverg=="far"], ylim=c(0,10))
boxplot(merged3$ref[merged3$diverg=="close"], merged3$ref[merged3$diverg=="far"], ylim=c(0,10))
m_host <- glmer(host_spp ~ diverg + (1|genus), data = merged, family="poisson")
z.obs <- coef(summary(m_host))[2, "z value"]
n.genera <- length(levels(merged$genus)) #number of genera
n.genera
levels(merged$genus)
unique(manu$genus)
test <- merged[merged$genus %in% manu$genus,]
test <- merged[merged$genus==manu$genus,]
test <- merged[merged$genus %in% manu$genus,]
View(test)
unique(merged$genus)
levels(merged)
levels(merged$genus)
droplevels(levels(merged$genus))
droplevels(merged$genus)
levels(merged$genus)
levels(merged$genus) <- droplevels(merged$genus)
levels(merged$genus)
n.genera <- length(levels(merged$genus)) #number of genera
l.genus <- as.vector(table(auto$genus)) #list w/ number of species per genus
l.genus <- as.vector(table(merged$genus)) #list w/ number of species per genus
merged$genus
l.genus
l.genus <- as.vector(table(auto$genus)) #list w/ number of species per genus
l.genus
merged$genus
View(merged)
rm(list=ls()); library(permute); library(nlme); library(lme4)
citat <-read.csv("~/Dropbox/Cyril-Casper_shared/Internship/Data/auto/auto_citations_per_species.csv", header=T)
manu0 <- read.csv("~/Documents/Internship/Data/R_working_directory/manual/manual_processed_data.csv")
manu <- merge(x=manu0, y=citat, by.x=c("family","genus","species"), by.y=c("family","genus","species"), all=F)
close_sex0 <-manu[manu$pair!=0 & manu$mode=="sex",]
close_sex <- cbind(close_sex0, diverg=rep("close"))
close_sex <- close_sex[!close_sex$nbr_country=="0" & !close_sex$nbr_host_spp=="0",]
# Loading dataset and merging dataset with citations. Only species for which both data and number of citations is available will be kept.
auto0 <- read.csv("~/Documents/Internship/Data/R_working_directory/auto/auto_processed_data.csv", header=T)
auto <- merge(x=auto0, y=citat, by.x=c("family","genus","species"), by.y=c("family","genus","species"), all=F)
auto <- auto[!auto$nbr_country =="0",] #remove species with no countries described
auto <- auto[!auto$host_spp =="0",] # remove species with no hosts described
# Conserving only sexual species
far_sex0 <- auto[auto$mode=="sex",]
# Adding a column, to label those species as "far", meaning they are not closely related to an asexual species.
far_sex <- cbind(far_sex0, diverg=rep("far"))
# Changing colnames for successful rbind.
close_sex <- close_sex[,c("family", "genus", "species", "mode", "lon_min", "lon_max",
"lon_mean", "lon_median", "lat_min", "lat_max", "lat_mean",
"lat_median", "nbr_country", "nbr_host_spp", "eco", "ref", "diverg")]
colnames(close_sex)[14] <- "host_spp"
far_sex <- far_sex[, c("family", "genus", "species", "mode", "lon_min", "lon_max", "lon_mean",
"lon_median", "lat_min", "lat_max", "lat_mean", "lat_median", "nbr_country",
"host_spp", "eco", "ref", "diverg")]
#Merging both sets with rbind.
merged_sets <- rbind(close_sex, far_sex[far_sex$genus %in% close_sex$genus,])
merged_sets <- merged_sets[!is.na(merged_sets$genus),]
# Removing all dupplicate species to keep only those coming from close_sex.
merged <- subset(merged_sets, subset = !(duplicated(merged_sets$species) & duplicated(merged_sets$species) &  merged_sets$diverg=="far"))
# Removing all genera without any "close" species.
levels(merged$genus) <- droplevels(merged$genus)
# Applying different cutoffs for references
merged2 <- merged[merged$ref>"2",] # remove species very few studies
merged3 <- merged[merged$ref>"4",] # remove species very few studies
merged4 <- merged[merged$ref>"7",] # remove species very few studies
##########
#ANALYSIS#
View(merged)
citat <-read.csv("~/Dropbox/Cyril-Casper_shared/Internship/Data/auto/auto_citations_per_species.csv", header=T)
manu0 <- read.csv("~/Documents/Internship/Data/R_working_directory/manual/manual_processed_data.csv")
manu <- merge(x=manu0, y=citat, by.x=c("family","genus","species"), by.y=c("family","genus","species"), all=F)
close_sex0 <-manu[manu$pair!=0 & manu$mode=="sex",]
close_sex <- cbind(close_sex0, diverg=rep("close"))
close_sex <- close_sex[!close_sex$nbr_country=="0" & !close_sex$nbr_host_spp=="0",]
# Loading dataset and merging dataset with citations. Only species for which both data and number of citations is available will be kept.
auto0 <- read.csv("~/Documents/Internship/Data/R_working_directory/auto/auto_processed_data.csv", header=T)
auto <- merge(x=auto0, y=citat, by.x=c("family","genus","species"), by.y=c("family","genus","species"), all=F)
auto <- auto[!auto$nbr_country =="0",] #remove species with no countries described
auto <- auto[!auto$host_spp =="0",] # remove species with no hosts described
# Conserving only sexual species
far_sex0 <- auto[auto$mode=="sex",]
# Adding a column, to label those species as "far", meaning they are not closely related to an asexual species.
far_sex <- cbind(far_sex0, diverg=rep("far"))
# Changing colnames for successful rbind.
close_sex <- close_sex[,c("family", "genus", "species", "mode", "lon_min", "lon_max",
"lon_mean", "lon_median", "lat_min", "lat_max", "lat_mean",
"lat_median", "nbr_country", "nbr_host_spp", "eco", "ref", "diverg")]
colnames(close_sex)[14] <- "host_spp"
far_sex <- far_sex[, c("family", "genus", "species", "mode", "lon_min", "lon_max", "lon_mean",
"lon_median", "lat_min", "lat_max", "lat_mean", "lat_median", "nbr_country",
"host_spp", "eco", "ref", "diverg")]
#Merging both sets with rbind.
View(close_sex)
merged_sets <- rbind(close_sex, far_sex[far_sex$genus %in% close_sex$genus,])
View(merged_sets)
merged_sets <- merged_sets[!is.na(merged_sets$genus),]
merged <- subset(merged_sets, subset = !(duplicated(merged_sets$species) & duplicated(merged_sets$genus) &  merged_sets$diverg=="far"))
View(merged)
levels(merged$genus) <- droplevels(merged$genus)
View(merged)
rm(list=ls()); library(permute); library(nlme); library(lme4)
######
#Data#
######
# Loading number of references.
citat <-read.csv("~/Dropbox/Cyril-Casper_shared/Internship/Data/auto/auto_citations_per_species.csv", header=T)
# Loading dataset and merging dataset with citations. Only species for which both data and number of citations is available will be kept.
manu0 <- read.csv("~/Documents/Internship/Data/R_working_directory/manual/manual_processed_data.csv")
manu <- merge(x=manu0, y=citat, by.x=c("family","genus","species"), by.y=c("family","genus","species"), all=F)
close_sex0 <-manu[manu$pair!=0 & manu$mode=="sex",]
close_sex <- cbind(close_sex0, diverg=rep("close"))
close_sex <- close_sex[!close_sex$nbr_country=="0" & !close_sex$nbr_host_spp=="0",]
# Loading dataset and merging dataset with citations. Only species for which both data and number of citations is available will be kept.
auto0 <- read.csv("~/Documents/Internship/Data/R_working_directory/auto/auto_processed_data.csv", header=T)
auto <- merge(x=auto0, y=citat, by.x=c("family","genus","species"), by.y=c("family","genus","species"), all=F)
auto <- auto[!auto$nbr_country =="0",] #remove species with no countries described
auto <- auto[!auto$host_spp =="0",] # remove species with no hosts described
# Conserving only sexual species
far_sex0 <- auto[auto$mode=="sex",]
# Adding a column, to label those species as "far", meaning they are not closely related to an asexual species.
far_sex <- cbind(far_sex0, diverg=rep("far"))
# Changing colnames for successful rbind.
close_sex <- close_sex[,c("family", "genus", "species", "mode", "lon_min", "lon_max",
"lon_mean", "lon_median", "lat_min", "lat_max", "lat_mean",
"lat_median", "nbr_country", "nbr_host_spp", "eco", "ref", "diverg")]
colnames(close_sex)[14] <- "host_spp"
far_sex <- far_sex[, c("family", "genus", "species", "mode", "lon_min", "lon_max", "lon_mean",
"lon_median", "lat_min", "lat_max", "lat_mean", "lat_median", "nbr_country",
"host_spp", "eco", "ref", "diverg")]
#Merging both sets with rbind.
merged_sets <- rbind(close_sex, far_sex[far_sex$genus %in% close_sex$genus,])
merged_sets <- merged_sets[!is.na(merged_sets$genus),]
# Removing all dupplicate species to keep only those coming from close_sex.
merged <- subset(merged_sets, subset = !(duplicated(merged_sets$species) & duplicated(merged_sets$genus) &  merged_sets$diverg=="far"))
levels(merged$genus)
droplevels(merged$genus)
levels(merged$genus)
merged$genus <-droplevels(merged$genus)
levels(merged$genus)
merged2 <- merged[merged$ref>"2",] # remove species very few studies
merged3 <- merged[merged$ref>"4",] # remove species very few studies
merged4 <- merged[merged$ref>"7",] # remove species very few studies
par(mfrow=c(1,3))
boxplot(merged$ref[merged$diverg=="close"], merged$ref[merged$diverg=="far"], ylim=c(0,10))
boxplot(merged2$ref[merged2$diverg=="close"], merged2$ref[merged2$diverg=="far"], ylim=c(0,10))
boxplot(merged3$ref[merged3$diverg=="close"], merged3$ref[merged3$diverg=="far"], ylim=c(0,10))
m_host <- glmer(host_spp ~ diverg + (1|genus), data = merged, family="poisson")
z.obs <- coef(summary(m_host))[2, "z value"]
n.genera <- length(levels(merged$genus)) #number of genera
l.genus <- as.vector(table(auto$genus)) #list w/ number of species per genus
l.genus
sum(l.genus)
l.genus <- as.vector(table(merged$genus)) #list w/ number of species per genus
l.genus
sum(l.genus)
nboot <- 100 #number of permutations
random_test <- function(x,y) {  #x: auto, y:genus
genus_name <- subset(x, genus == y)$genus
species_name <- subset(x, genus == y)$species
host_spp <- subset(x, genus == y)$host_spp
# Sample without replacement
random_diverg <- sample(subset(x, genus == y)$diverg)
# Return a partial data frame (for each genus)
return(data.frame(genus_name, species_name, host_spp, random_diverg))
}
zval_model <- function(data, n.genera){
# Complete data frame initialization.
ref.distri <- data.frame(x= character(0), y= character(0), z = character(0))
for (t in 1:n.genera) {
# Sub data frame (for each genus).
part_distri <- random_test(data, levels(data$genus)[t])
# Concatenation of each sub data frames.
ref.distri <- rbind(ref.distri, part_distri)
}
#print(ref.distri)
# Model
m1 <- glmer(host_spp ~ random_diverg + (1|genus_name), data = ref.distri, family="poisson")
return(coef(summary(m1))[2, "z value"]) # Return zvalue
}
zval.reference <- replicate(nboot, zval_model(merged, n.genera))
hist(zval.reference, breaks = 30, xlim=c(-60, 60)) # Vector of nboot pvalues.
hist(zval.reference, breaks = 30, xlim=c(-60, 60)) # Vector of nboot pvalues.
abline(v=z.obs, col="red", lwd=3)
quantile(zval.reference,c(0.025, 0.975))
sum(z.obs>zval.reference)/nboot
